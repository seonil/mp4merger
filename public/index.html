<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ì˜ìƒ í¸ì§‘ ë„êµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        header {
            padding: 24px 32px;
            border-bottom: 1px solid #e0e0e0;
        }

        h1 {
            font-size: 20px;
            font-weight: 500;
            color: #000;
            margin-bottom: 4px;
        }

        .subtitle {
            font-size: 13px;
            color: #666;
            font-weight: 400;
        }

        main {
            padding: 32px;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
            color: #000;
        }

        .folder-browser {
            border: 1px solid #ddd;
            border-radius: 2px;
            margin-bottom: 16px;
        }

        .current-path {
            padding: 12px 16px;
            background: #fafafa;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .folder-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.15s;
            display: flex;
            align-items: center;
        }

        .folder-item:hover {
            background: #fafafa;
        }

        .folder-item:last-child {
            border-bottom: none;
        }

        .folder-icon {
            margin-right: 8px;
            color: #999;
        }

        button {
            background: #000;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 13px;
            cursor: pointer;
            border-radius: 2px;
            font-weight: 400;
            transition: opacity 0.15s;
        }

        button:hover {
            opacity: 0.8;
        }

        button:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            opacity: 1;
        }

        button.secondary {
            background: white;
            color: #000;
            border: 1px solid #ddd;
        }

        button.secondary:hover {
            background: #fafafa;
            opacity: 1;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .sort-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 2px;
            font-size: 13px;
            background: white;
            cursor: pointer;
        }

        .video-list {
            border: 1px solid #ddd;
            border-radius: 2px;
            margin-top: 16px;
            max-height: 500px;
            overflow-y: auto;
        }

        .video-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background 0.15s;
        }

        .video-item:hover {
            background: #fafafa;
        }

        .video-item:last-child {
            border-bottom: none;
        }

        .video-item input[type="checkbox"] {
            margin-right: 12px;
            cursor: pointer;
        }

        .video-info {
            flex: 1;
        }

        .video-name {
            font-size: 13px;
            color: #000;
            margin-bottom: 4px;
        }

        .video-size {
            font-size: 12px;
            color: #999;
        }

        .video-actions {
            display: flex;
            gap: 8px;
        }

        .video-actions button {
            padding: 6px 12px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 48px;
            color: #999;
            font-size: 13px;
        }

        .status {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 2px;
            font-size: 13px;
            display: none;
            border-left: 3px solid;
        }

        .status.success {
            background: #f0f9f0;
            color: #2e7d32;
            border-left-color: #2e7d32;
            display: block;
        }

        .status.error {
            background: #fef0f0;
            color: #c62828;
            border-left-color: #c62828;
            display: block;
        }

        .status.info {
            background: #f0f4f9;
            color: #1565c0;
            border-left-color: #1565c0;
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 2px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .modal-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .path-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 2px;
            font-size: 13px;
            font-family: inherit;
        }

        .path-input:focus {
            outline: none;
            border-color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ë™ì˜ìƒ í¸ì§‘ ë„êµ¬</h1>
            <p class="subtitle">MP4 ë™ì˜ìƒ ë³‘í•© ë° ìë¥´ê¸°</p>
        </header>

        <main>
            <div class="section">
                <div class="section-title">í´ë” ì„ íƒ</div>
                <div class="folder-browser">
                    <div class="current-path">
                        <span id="currentPath">í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                        <button class="secondary" onclick="goUpFolder()">â†‘ ìƒìœ„ í´ë”</button>
                    </div>
                    <div class="folder-list" id="folderList">
                        <div class="empty-state">í´ë” ì°¾ì•„ë³´ê¸°ë¥¼ ì‹œì‘í•˜ì„¸ìš”</div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="secondary" onclick="startBrowsing()">í´ë” ì°¾ì•„ë³´ê¸°</button>
                    <button class="secondary" onclick="showManualPath()">ì§ì ‘ ì…ë ¥</button>
                    <button onclick="loadVideos()">ë™ì˜ìƒ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ë™ì˜ìƒ ëª©ë¡</div>
                <div class="controls">
                    <select class="sort-select" id="sortSelect" onchange="sortVideos()">
                        <option value="name">ì´ë¦„ìˆœ</option>
                        <option value="date">ë‚ ì§œìˆœ</option>
                        <option value="size">í¬ê¸°ìˆœ</option>
                    </select>
                    <button class="secondary" onclick="selectAll()">ì „ì²´ ì„ íƒ</button>
                    <button class="secondary" onclick="deselectAll()">ì„ íƒ í•´ì œ</button>
                    <button onclick="showMergeModal()" id="mergeBtn" disabled>ì„ íƒ í•­ëª© ë³‘í•©</button>
                </div>
                <div class="button-group" style="margin-top: 12px;">
                    <button class="secondary" onclick="showSpeedModal(2)" id="speed2Btn" disabled>2ë°°ì†</button>
                    <button class="secondary" onclick="showSpeedModal(4)" id="speed4Btn" disabled>4ë°°ì†</button>
                    <button class="secondary" onclick="showSpeedModal(8)" id="speed8Btn" disabled>8ë°°ì†</button>
                    <button class="secondary" onclick="showTimelapseModal()" id="timelapseBtn" disabled>íƒ€ì„ë©ìŠ¤</button>
                </div>
                <div class="video-list" id="videoList">
                    <div class="empty-state">í´ë”ì—ì„œ ë™ì˜ìƒì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”</div>
                </div>
            </div>

            <div class="status" id="status"></div>
        </main>
    </div>

    <!-- Manual Path Input Modal -->
    <div class="modal" id="pathModal">
        <div class="modal-content">
            <div class="modal-title">í´ë” ê²½ë¡œ ì…ë ¥</div>
            <input type="text" class="path-input" id="manualPath" placeholder="ì˜ˆ: C:\Videos ë˜ëŠ” /home/user/videos">
            <div class="modal-buttons">
                <button class="secondary" onclick="closeModal('pathModal')">ì·¨ì†Œ</button>
                <button onclick="setManualPath()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- Output Folder Modal -->
    <div class="modal" id="outputModal">
        <div class="modal-content">
            <div class="modal-title">ì €ì¥ ìœ„ì¹˜ ì„ íƒ</div>
            <p style="font-size: 13px; color: #666; margin-bottom: 16px;">ë³‘í•©ëœ íŒŒì¼ì„ ì €ì¥í•  ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            <input type="text" class="path-input" id="outputPath" placeholder="ë¹„ì›Œë‘ë©´ ì›ë³¸ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤">
            <div class="modal-buttons">
                <button class="secondary" onclick="closeModal('outputModal')">ì·¨ì†Œ</button>
                <button onclick="executeMerge()">ë³‘í•© ì‹œì‘</button>
            </div>
        </div>
    </div>

    <!-- Trim Output Folder Modal -->
    <div class="modal" id="trimOutputModal">
        <div class="modal-content">
            <div class="modal-title">ì €ì¥ ìœ„ì¹˜ ì„ íƒ</div>
            <p style="font-size: 13px; color: #666; margin-bottom: 16px;">ìë¥¸ íŒŒì¼ì„ ì €ì¥í•  ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            <input type="text" class="path-input" id="trimOutputPath" placeholder="ë¹„ì›Œë‘ë©´ ì›ë³¸ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤">
            <div class="modal-buttons">
                <button class="secondary" onclick="closeModal('trimOutputModal')">ì·¨ì†Œ</button>
                <button onclick="executeTrim()">ìë¥´ê¸° ì‹œì‘</button>
            </div>
        </div>
    </div>

    <!-- Speed Change Modal -->
    <div class="modal" id="speedModal">
        <div class="modal-content">
            <div class="modal-title">ì†ë„ ë³€ê²½</div>
            <p style="font-size: 13px; color: #666; margin-bottom: 16px;" id="speedModalText">ì„ íƒí•œ íŒŒì¼ì„ 2ë°°ì†ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
            <input type="text" class="path-input" id="speedOutputPath" placeholder="ë¹„ì›Œë‘ë©´ ì›ë³¸ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤">
            <div class="modal-buttons">
                <button class="secondary" onclick="closeModal('speedModal')">ì·¨ì†Œ</button>
                <button onclick="executeSpeed()">ë³€í™˜ ì‹œì‘</button>
            </div>
        </div>
    </div>

    <!-- Timelapse Modal -->
    <div class="modal" id="timelapseModal">
        <div class="modal-content">
            <div class="modal-title">íƒ€ì„ë©ìŠ¤ ìƒì„±</div>
            <p style="font-size: 13px; color: #666; margin-bottom: 12px;">íƒ€ì„ë©ìŠ¤ FPSë¥¼ ì„ íƒí•˜ì„¸ìš” (ì˜¤ë””ì˜¤ ì œê±°ë¨)</p>
            <select class="sort-select" id="timelapseFps" style="width: 100%; margin-bottom: 16px;">
                <option value="30">30 FPS (ë¹ ë¦„)</option>
                <option value="60" selected>60 FPS (ê¶Œì¥)</option>
                <option value="120">120 FPS (ë§¤ìš° ë¹ ë¦„)</option>
                <option value="240">240 FPS (ì´ˆê³ ì†)</option>
            </select>
            <input type="text" class="path-input" id="timelapseOutputPath" placeholder="ë¹„ì›Œë‘ë©´ ì›ë³¸ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤">
            <div class="modal-buttons">
                <button class="secondary" onclick="closeModal('timelapseModal')">ì·¨ì†Œ</button>
                <button onclick="executeTimelapse()">ìƒì„± ì‹œì‘</button>
            </div>
        </div>
    </div>

    <script>
        let videos = [];
        let currentFolder = '';
        let currentPath = '';
        let currentTrimVideo = '';
        let currentSpeed = 2;

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showManualPath() {
            showModal('pathModal');
        }

        function setManualPath() {
            const path = document.getElementById('manualPath').value.trim();
            if (path) {
                currentFolder = path;
                currentPath = path;
                document.getElementById('currentPath').textContent = path;
                closeModal('pathModal');
            }
        }

        function startBrowsing() {
            // Start browsing from home directory
            browseFolders();
        }

        async function browseFolders(path) {
            try {
                const url = path ? `/api/browse?path=${encodeURIComponent(path)}` : '/api/browse';
                const response = await fetch(url);

                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || 'í´ë”ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                const data = await response.json();

                currentPath = data.current;
                document.getElementById('currentPath').textContent = currentPath;

                const listEl = document.getElementById('folderList');
                if (data.folders.length === 0) {
                    listEl.innerHTML = '<div class="empty-state">í•˜ìœ„ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                } else {
                    listEl.innerHTML = data.folders.map(folder => `
                        <div class="folder-item" onclick="browseFolders('${folder.path.replace(/\\/g, '\\\\')}')">
                            <span class="folder-icon">ğŸ“</span>
                            ${folder.name}
                        </div>
                    `).join('');
                }

                currentFolder = currentPath;
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                console.error(error);
            }
        }

        async function goUpFolder() {
            if (!currentPath) {
                showStatus('ë¨¼ì € í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }
            const separator = currentPath.includes('\\') ? '\\' : '/';
            const parts = currentPath.split(/[/\\]/);

            if (parts.length > 1) {
                const parent = parts.slice(0, -1).join(separator);
                if (parent) {
                    await browseFolders(parent);
                }
            }
        }

        async function loadVideos() {
            if (!currentFolder) {
                showStatus('í´ë”ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            showStatus('ë™ì˜ìƒ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');

            try {
                const response = await fetch(`/api/videos?folder=${encodeURIComponent(currentFolder)}`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'ë™ì˜ìƒì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                videos = data;
                sortVideos();
                showStatus(`${videos.length}ê°œ ë™ì˜ìƒì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤`, 'success');
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                console.error(error);
            }
        }

        function sortVideos() {
            const sortBy = document.getElementById('sortSelect').value;

            const sorted = [...videos].sort((a, b) => {
                if (sortBy === 'name') {
                    return a.name.localeCompare(b.name);
                } else if (sortBy === 'date') {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                } else if (sortBy === 'size') {
                    return b.size - a.size;
                }
                return 0;
            });

            videos = sorted;
            renderVideos();
        }

        function renderVideos() {
            const listEl = document.getElementById('videoList');

            if (videos.length === 0) {
                listEl.innerHTML = '<div class="empty-state">ì´ í´ë”ì— MP4 íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            listEl.innerHTML = videos.map((video, index) => `
                <div class="video-item">
                    <input type="checkbox" id="video-${index}" onclick="event.stopPropagation(); updateMergeButton()">
                    <div class="video-info" onclick="toggleVideo(${index})">
                        <div class="video-name">${video.name}</div>
                        <div class="video-size">${formatBytes(video.size)}</div>
                    </div>
                    <div class="video-actions">
                        <button class="secondary" onclick="event.stopPropagation(); trimVideo('${video.name}')">
                            ì• 30ì´ˆ ìë¥´ê¸°
                        </button>
                    </div>
                </div>
            `).join('');

            updateMergeButton();
        }

        function toggleVideo(index) {
            const checkbox = document.getElementById(`video-${index}`);
            checkbox.checked = !checkbox.checked;
            updateMergeButton();
        }

        function selectAll() {
            videos.forEach((_, index) => {
                const checkbox = document.getElementById(`video-${index}`);
                if (checkbox) checkbox.checked = true;
            });
            updateMergeButton();
        }

        function deselectAll() {
            videos.forEach((_, index) => {
                const checkbox = document.getElementById(`video-${index}`);
                if (checkbox) checkbox.checked = false;
            });
            updateMergeButton();
        }

        function updateMergeButton() {
            const selectedCount = videos.filter((_, index) => {
                const checkbox = document.getElementById(`video-${index}`);
                return checkbox && checkbox.checked;
            }).length;

            const mergeBtn = document.getElementById('mergeBtn');
            mergeBtn.disabled = selectedCount < 2;

            // Update speed buttons
            const speed2Btn = document.getElementById('speed2Btn');
            const speed4Btn = document.getElementById('speed4Btn');
            const speed8Btn = document.getElementById('speed8Btn');
            const timelapseBtn = document.getElementById('timelapseBtn');
            const hasSelection = selectedCount > 0;

            speed2Btn.disabled = !hasSelection;
            speed4Btn.disabled = !hasSelection;
            speed8Btn.disabled = !hasSelection;
            timelapseBtn.disabled = !hasSelection;
        }

        function showMergeModal() {
            showModal('outputModal');
        }

        async function executeMerge() {
            const selectedVideos = videos
                .filter((_, index) => {
                    const checkbox = document.getElementById(`video-${index}`);
                    return checkbox && checkbox.checked;
                })
                .map(v => v.name);

            if (selectedVideos.length < 2) {
                showStatus('ìµœì†Œ 2ê°œ ì´ìƒì˜ ë™ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const outputFolder = document.getElementById('outputPath').value.trim() || null;
            closeModal('outputModal');

            showStatus('ë™ì˜ìƒ ë³‘í•© ì¤‘... ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
            document.getElementById('mergeBtn').disabled = true;

            try {
                const response = await fetch('/api/merge', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        videos: selectedVideos,
                        folder: currentFolder,
                        outputFolder: outputFolder
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'ë³‘í•©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }

                showStatus(`ì™„ë£Œ! íŒŒì¼: ${data.outputFile}\nìœ„ì¹˜: ${data.outputPath}`, 'success');
                document.getElementById('outputPath').value = '';
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                console.error(error);
            } finally {
                updateMergeButton();
            }
        }

        function trimVideo(videoName) {
            currentTrimVideo = videoName;
            showModal('trimOutputModal');
        }

        async function executeTrim() {
            const outputFolder = document.getElementById('trimOutputPath').value.trim() || null;
            closeModal('trimOutputModal');

            showStatus(`"${currentTrimVideo}" ìë¥´ëŠ” ì¤‘...`, 'info');

            try {
                const response = await fetch('/api/trim', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        video: currentTrimVideo,
                        folder: currentFolder,
                        outputFolder: outputFolder
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'ìë¥´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }

                showStatus(`ì™„ë£Œ! íŒŒì¼: ${data.outputFile}\nìœ„ì¹˜: ${data.outputPath}`, 'success');
                document.getElementById('trimOutputPath').value = '';
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                console.error(error);
            }
        }

        function showSpeedModal(speed) {
            currentSpeed = speed;
            document.getElementById('speedModalText').textContent = `ì„ íƒí•œ íŒŒì¼ì„ ${speed}ë°°ì†ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.`;
            showModal('speedModal');
        }

        async function executeSpeed() {
            const selectedVideos = videos
                .filter((_, index) => {
                    const checkbox = document.getElementById(`video-${index}`);
                    return checkbox && checkbox.checked;
                })
                .map(v => v.name);

            if (selectedVideos.length === 0) {
                showStatus('ìµœì†Œ 1ê°œ ì´ìƒì˜ ë™ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const outputFolder = document.getElementById('speedOutputPath').value.trim() || null;
            closeModal('speedModal');

            showStatus(`ë™ì˜ìƒ ${currentSpeed}ë°°ì† ë³€í™˜ ì¤‘... ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'info');
            document.getElementById('speed2Btn').disabled = true;
            document.getElementById('speed4Btn').disabled = true;
            document.getElementById('speed8Btn').disabled = true;

            try {
                const response = await fetch('/api/speedup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        videos: selectedVideos,
                        folder: currentFolder,
                        speed: currentSpeed,
                        outputFolder: outputFolder
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'ì†ë„ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }

                showStatus(`ì™„ë£Œ! ${data.processed}ê°œ íŒŒì¼ ì²˜ë¦¬ë¨\nìœ„ì¹˜: ${data.outputPath}`, 'success');
                document.getElementById('speedOutputPath').value = '';
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                console.error(error);
            } finally {
                updateMergeButton();
            }
        }

        function showTimelapseModal() {
            showModal('timelapseModal');
        }

        async function executeTimelapse() {
            const selectedVideos = videos
                .filter((_, index) => {
                    const checkbox = document.getElementById(`video-${index}`);
                    return checkbox && checkbox.checked;
                })
                .map(v => v.name);

            if (selectedVideos.length === 0) {
                showStatus('ìµœì†Œ 1ê°œ ì´ìƒì˜ ë™ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const fps = parseInt(document.getElementById('timelapseFps').value);
            const outputFolder = document.getElementById('timelapseOutputPath').value.trim() || null;
            closeModal('timelapseModal');

            showStatus(`íƒ€ì„ë©ìŠ¤ ìƒì„± ì¤‘... ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'info');
            document.getElementById('timelapseBtn').disabled = true;

            try {
                const response = await fetch('/api/timelapse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        videos: selectedVideos,
                        folder: currentFolder,
                        fps: fps,
                        outputFolder: outputFolder
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'íƒ€ì„ë©ìŠ¤ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }

                showStatus(`ì™„ë£Œ! ${data.processed}ê°œ íŒŒì¼ ì²˜ë¦¬ë¨\nìœ„ì¹˜: ${data.outputPath}`, 'success');
                document.getElementById('timelapseOutputPath').value = '';
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                console.error(error);
            } finally {
                updateMergeButton();
            }
        }
    </script>
</body>
</html>